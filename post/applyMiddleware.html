<!DOCTYPE html><html lang="en-US"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><title>reduxæºç ç³»åˆ—ä¹‹applyMiddleware | Xu dongdong&#x27;s blog</title><meta name="description" content="A blog created with Next.js and Tailwind.css"/><meta property="og:type" content="website"/><meta name="og:title" property="og:title" content="reduxæºç ç³»åˆ—ä¹‹applyMiddleware"/><meta name="og:description" property="og:description" content="A blog created with Next.js and Tailwind.css"/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="reduxæºç ç³»åˆ—ä¹‹applyMiddleware"/><meta name="twitter:description" content="A blog created with Next.js and Tailwind.css"/><meta name="twitter:creator" content="https://twitter.com/WhyYouJames"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="manifest" href="/site.webmanifest"/><meta name="next-head-count" content="16"/><link rel="preload" href="/_next/static/css/f8d73a71d7937abe53e1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f8d73a71d7937abe53e1.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-c6f966696d7d46f48c33.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.10b3d8f36ae5d485c3da.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.18cd929bdef6e2f96561.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-7c6d80ab417193f95407.js" as="script"/><link rel="preload" href="/_next/static/chunks/1173eff4538ab0eae4f3f506dea9a7965770ad37.102498c830e6881bc94f.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/post/%5Bslug%5D-0058a7b1fd50a50b0cad.js" as="script"/></head><body><div id="__next"><div class="w-full min-h-screen dark:bg-gray-700 dark:text-white flex"><div class="max-w-screen-md px-4 py-12 mx-auto antialiased font-body flex flex-col flex-grow"><header class="flex items-center justify-between  mb-2"><div class="max-w-lg"><h1><a class="text-2xl font-black text-black no-underline font-display dark:text-white" href="/">Xu dongdong&#x27;s blog</a></h1></div></header><main class="flex-grow"><article><header class="mb-8"><h1 class="mb-2 text-6xl font-black leading-none font-display">reduxæºç ç³»åˆ—ä¹‹applyMiddleware</h1><p class="text-sm">June 28, 2021</p></header><div class="mb-4 prose lg:prose-lg dark:prose-dark"><p>ç»ˆäºæ¥åˆ° <strong>applyMiddleware</strong> éƒ¨åˆ†ï¼Œç†è§£äº† <a href="https://xudongdong.site/post/compose"><strong>compose</strong></a> å’Œ <a href="https://xudongdong.site/post/currying"><strong>Currying</strong></a>ï¼Œè¿™éƒ¨åˆ†æºç ä¹Ÿå˜å¾—å¾ˆå¥½ç†è§£</p><p>è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥åº”ç”¨ä¸­é—´ä»¶çš„ï¼Œç”¨è¿‡ <strong>node</strong> çš„åŒå­¦åº”è¯¥æ¯”è¾ƒäº†è§£ï¼Œä¸­é—´ä»¶æˆ‘çš„ç†è§£ç±»ä¼¼äºæ’ä»¶ï¼Œä¸€èˆ¬ä¸ºäº†é¿å…ç³»ç»Ÿæ¡†æ¶è¿‡äºè‡ƒè‚¿ï¼Œæˆ‘ä»¬æŠŠå¸¸ç”¨çš„åŠŸèƒ½å‰¥ç¦»å¼€æ¥ï¼Œä»¥ä¸­é—´ä»¶çš„å½¢å¼æ’å…¥åˆ°æ¡†æ¶ä¸­æ¥å®ç°å¤æ‚çš„åº”ç”¨å¤„ç†</p><p>æˆ‘ä»¬é¦–å…ˆçœ‹ä¸‹ <strong>applyMiddleware</strong> çš„ç”¨æ³•</p><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-js" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token module" style="color:#8be9fd">import</span><span> </span><span class="token imports" style="color:#f8f8f2">{</span><span class="token imports"> applyMiddleware </span><span class="token imports" style="color:#f8f8f2">}</span><span> </span><span class="token module" style="color:#8be9fd">from</span><span> </span><span class="token" style="color:#50fa7b">&#x27;redux&#x27;</span><span class="token" style="color:#f8f8f2">;</span><span>
</span><span></span><span class="token module" style="color:#8be9fd">import</span><span> </span><span class="token imports">thunk</span><span> </span><span class="token module" style="color:#8be9fd">from</span><span> </span><span class="token" style="color:#50fa7b">&#x27;redux-thunk&#x27;</span><span class="token" style="color:#f8f8f2">;</span><span>
</span><span></span><span class="token module" style="color:#8be9fd">import</span><span> </span><span class="token imports">logger</span><span> </span><span class="token module" style="color:#8be9fd">from</span><span> </span><span class="token" style="color:#50fa7b">&#x27;redux-logger&#x27;</span><span class="token" style="color:#f8f8f2">;</span><span>
</span>
<span></span><span class="token" style="color:#8be9fd">const</span><span> store </span><span class="token" style="color:#f8f8f2">=</span><span> </span><span class="token" style="color:#f1fa8c">createStore</span><span class="token" style="color:#f8f8f2">(</span><span>reducer</span><span class="token" style="color:#f8f8f2">,</span><span> </span><span class="token" style="color:#f1fa8c">applyMiddleware</span><span class="token" style="color:#f8f8f2">(</span><span>thunk</span><span class="token" style="color:#f8f8f2">,</span><span> logger</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">)</span></code></pre><p><strong>createStore</strong> å†…éƒ¨çš„è°ƒç”¨</p><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-js" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#8be9fd">function</span><span> </span><span class="token" style="color:#f1fa8c">createStore</span><span class="token" style="color:#f8f8f2">(</span><span class="token parameter">reducer</span><span class="token parameter" style="color:#f8f8f2">,</span><span class="token parameter"> preloadedState</span><span class="token parameter" style="color:#f8f8f2">,</span><span class="token parameter"> enhancer</span><span class="token" style="color:#f8f8f2">)</span><span> </span><span class="token" style="color:#f8f8f2">{</span><span>
</span><span>  </span><span class="token" style="color:#6272a4">// ä¼ å…¥å‚æ•°çš„åˆ¤æ–­</span><span>
</span><span>  </span><span class="token" style="color:#6272a4">// ...</span><span>
</span>
<span>  </span><span class="token" style="color:#6272a4">// å‚æ•°ä¸­enhancer functionå­˜åœ¨ï¼Œä¸€èˆ¬æ˜¯æŒ‡applyMiddleware()</span><span>
</span><span>  </span><span class="token control-flow" style="color:#8be9fd">if</span><span> </span><span class="token" style="color:#f8f8f2">(</span><span class="token" style="color:#8be9fd">typeof</span><span> enhancer </span><span class="token" style="color:#f8f8f2">!==</span><span> </span><span class="token" style="color:#50fa7b">&quot;undefined&quot;</span><span> </span><span class="token" style="color:#f8f8f2">&amp;&amp;</span><span> </span><span class="token" style="color:#8be9fd">typeof</span><span> enhancer </span><span class="token" style="color:#f8f8f2">===</span><span> </span><span class="token" style="color:#50fa7b">&quot;function&quot;</span><span class="token" style="color:#f8f8f2">)</span><span> </span><span class="token" style="color:#f8f8f2">{</span><span>
</span><span>    </span><span class="token control-flow" style="color:#8be9fd">return</span><span> </span><span class="token" style="color:#f1fa8c">enhancer</span><span class="token" style="color:#f8f8f2">(</span><span>createStore</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">(</span><span>reducer</span><span class="token" style="color:#f8f8f2">,</span><span> preloadedState</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">;</span><span>
</span><span>  </span><span class="token" style="color:#f8f8f2">}</span><span>
</span>
<span>  </span><span class="token" style="color:#6272a4">// çœç•¥</span><span>
</span><span></span><span class="token" style="color:#f8f8f2">}</span></code></pre><p>ç”±æ­¤å¯ä»¥å¾—å‡º <strong>applyMiddleware</strong> çš„ <strong>API</strong> è°ƒç”¨</p><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-js" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#f1fa8c">applyMiddleware</span><span class="token" style="color:#f8f8f2">(</span><span>thunk</span><span class="token" style="color:#f8f8f2">,</span><span> logger</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">(</span><span>createStore</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">(</span><span>reducer</span><span class="token" style="color:#f8f8f2">,</span><span> preloadedState</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">;</span><span>
</span>
<span></span><span class="token" style="color:#6272a4">// applyMiddleware(...middlewares)(createStore)(reducer, preloadedState);</span></code></pre><p>ç»“åˆæºç </p><p>æˆ‘ä»¬å°†æºç ä¸­ <strong>TS</strong> éƒ¨åˆ†å»é™¤ï¼Œå¾—å‡ºå‡½æ•°ä¸»ä½“ä»£ç </p><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-javascript" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token module" style="color:#8be9fd">import</span><span> </span><span class="token imports" style="color:#f8f8f2">{</span><span class="token imports"> compose </span><span class="token imports" style="color:#f8f8f2">}</span><span> </span><span class="token module" style="color:#8be9fd">from</span><span> </span><span class="token" style="color:#50fa7b">&quot;./compose&quot;</span><span class="token" style="color:#f8f8f2">;</span><span>
</span>
<span></span><span class="token" style="color:#8be9fd">function</span><span> </span><span class="token" style="color:#f1fa8c">applyMiddleware</span><span class="token" style="color:#f8f8f2">(</span><span class="token parameter spread" style="color:#f8f8f2">...</span><span class="token parameter">middlewares</span><span class="token" style="color:#f8f8f2">)</span><span> </span><span class="token" style="color:#f8f8f2">{</span><span>
</span><span>  </span><span class="token" style="color:#6272a4">// use Currying function</span><span>
</span><span>  </span><span class="token control-flow" style="color:#8be9fd">return</span><span> </span><span class="token" style="color:#f8f8f2">(</span><span class="token parameter">createStore</span><span class="token" style="color:#f8f8f2">)</span><span> </span><span class="token arrow" style="color:#f8f8f2">=&gt;</span><span> </span><span class="token" style="color:#f8f8f2">(</span><span class="token parameter">reducer</span><span class="token parameter" style="color:#f8f8f2">,</span><span class="token parameter"> preloadedState</span><span class="token" style="color:#f8f8f2">)</span><span> </span><span class="token arrow" style="color:#f8f8f2">=&gt;</span><span> </span><span class="token" style="color:#f8f8f2">{</span><span>
</span><span>    </span><span class="token" style="color:#6272a4">// è·å–store</span><span>
</span><span>    </span><span class="token" style="color:#8be9fd">const</span><span> store </span><span class="token" style="color:#f8f8f2">=</span><span> </span><span class="token" style="color:#f1fa8c">createStore</span><span class="token" style="color:#f8f8f2">(</span><span>reducer</span><span class="token" style="color:#f8f8f2">,</span><span> preloadedState</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">;</span><span>
</span><span>    </span><span class="token" style="color:#6272a4">// åˆå§‹åŒ–dispatch</span><span>
</span><span>    </span><span class="token" style="color:#8be9fd">let</span><span> </span><span class="token function-variable" style="color:#f1fa8c">dispatch</span><span> </span><span class="token" style="color:#f8f8f2">=</span><span> </span><span class="token" style="color:#f8f8f2">(</span><span class="token" style="color:#f8f8f2">)</span><span> </span><span class="token arrow" style="color:#f8f8f2">=&gt;</span><span> </span><span class="token" style="color:#f8f8f2">{</span><span>
</span><span>      </span><span class="token" style="color:#6272a4">// åœ¨dispatchå®Œæˆæ­£åœ¨èµ‹å€¼ä¹‹å‰ï¼Œè°ƒç”¨ä¼šæŠ¥é”™</span><span>
</span><span>      </span><span class="token control-flow" style="color:#8be9fd">throw</span><span> </span><span class="token" style="color:#8be9fd">new</span><span> </span><span class="token" style="color:#f1fa8c">Error</span><span class="token" style="color:#f8f8f2">(</span><span class="token" style="color:#50fa7b">&quot;ç›®å‰è¿˜ä¸èƒ½ä½¿ç”¨dispatch&quot;</span><span class="token" style="color:#f8f8f2">)</span><span>
</span><span>    </span><span class="token" style="color:#f8f8f2">}</span><span>
</span>
<span>    </span><span class="token" style="color:#6272a4">// ç»™æ¯ä¸ªä¸­é—´ä»¶çš„é»˜è®¤ä¼ å‚ï¼šgetStateï¼Œdispatch</span><span>
</span><span>    </span><span class="token" style="color:#8be9fd">const</span><span> middlewareAPI </span><span class="token" style="color:#f8f8f2">=</span><span> </span><span class="token" style="color:#f8f8f2">{</span><span>
</span><span>      getState</span><span class="token" style="color:#f8f8f2">:</span><span> store</span><span class="token" style="color:#f8f8f2">.</span><span class="token property-access">getState</span><span class="token" style="color:#f8f8f2">,</span><span>
</span><span>      </span><span class="token function-variable" style="color:#f1fa8c">dispatch</span><span class="token" style="color:#f8f8f2">:</span><span> </span><span class="token" style="color:#f8f8f2">(</span><span class="token parameter">action</span><span class="token parameter" style="color:#f8f8f2">,</span><span class="token parameter"> </span><span class="token parameter spread" style="color:#f8f8f2">...</span><span class="token parameter">args</span><span class="token" style="color:#f8f8f2">)</span><span> </span><span class="token arrow" style="color:#f8f8f2">=&gt;</span><span> </span><span class="token" style="color:#f1fa8c">dispatch</span><span class="token" style="color:#f8f8f2">(</span><span>action</span><span class="token" style="color:#f8f8f2">,</span><span> </span><span class="token spread" style="color:#f8f8f2">...</span><span>args</span><span class="token" style="color:#f8f8f2">)</span><span>
</span><span>    </span><span class="token" style="color:#f8f8f2">}</span><span>
</span>    
<span>    </span><span class="token" style="color:#6272a4">// åŠ å…¥é»˜è®¤å‚æ•°åçš„ä¸­é—´ä»¶chain</span><span>
</span><span>    </span><span class="token" style="color:#8be9fd">const</span><span> chain </span><span class="token" style="color:#f8f8f2">=</span><span> middlewares</span><span class="token" style="color:#f8f8f2">.</span><span class="token method property-access" style="color:#f1fa8c">map</span><span class="token" style="color:#f8f8f2">(</span><span class="token parameter">middleware</span><span> </span><span class="token arrow" style="color:#f8f8f2">=&gt;</span><span> </span><span class="token" style="color:#f1fa8c">middleware</span><span class="token" style="color:#f8f8f2">(</span><span>middlewareAPI</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">)</span><span>
</span><span>    </span><span class="token" style="color:#6272a4">// å¯¹chainåšcomposeæ“ä½œï¼Œå¹¶èµ‹å€¼ç»™dispatch</span><span>
</span><span>    dispatch </span><span class="token" style="color:#f8f8f2">=</span><span> </span><span class="token" style="color:#f1fa8c">compose</span><span class="token" style="color:#f8f8f2">(</span><span class="token spread" style="color:#f8f8f2">...</span><span>chain</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">(</span><span>store</span><span class="token" style="color:#f8f8f2">.</span><span class="token property-access">dispatch</span><span class="token" style="color:#f8f8f2">)</span><span>
</span><span>  </span><span class="token" style="color:#f8f8f2">}</span><span>
</span>
<span>  </span><span class="token" style="color:#6272a4">// è¿”å›storeçš„å±æ€§å’Œdispatch</span><span>
</span><span>  </span><span class="token control-flow" style="color:#8be9fd">return</span><span> </span><span class="token" style="color:#f8f8f2">{</span><span>
</span><span>    </span><span class="token spread" style="color:#f8f8f2">...</span><span>store</span><span class="token" style="color:#f8f8f2">,</span><span>
</span>    dispatch
<span>  </span><span class="token" style="color:#f8f8f2">}</span><span>
</span><span></span><span class="token" style="color:#f8f8f2">}</span></code></pre><p>ä¸»è¦éš¾ä»¥ç†è§£çš„éƒ¨åˆ†è¿˜æ˜¯ <strong>compose</strong> è¿™ä¸€å—</p><p>æˆ‘ä»¬æ‹¿ä¸¤ä¸ªä¸­é—´ä»¶åšè§£æ</p><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-javascript" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token module" style="color:#8be9fd">import</span><span> </span><span class="token imports">thunk</span><span> </span><span class="token module" style="color:#8be9fd">from</span><span> </span><span class="token" style="color:#50fa7b">&#x27;redux-thunk&#x27;</span><span class="token" style="color:#f8f8f2">;</span><span>
</span><span></span><span class="token module" style="color:#8be9fd">import</span><span> </span><span class="token imports">logger</span><span> </span><span class="token module" style="color:#8be9fd">from</span><span> </span><span class="token" style="color:#50fa7b">&#x27;redux-logger&#x27;</span><span class="token" style="color:#f8f8f2">;</span><span>
</span>
<span></span><span class="token" style="color:#f1fa8c">applyMiddleware</span><span class="token" style="color:#f8f8f2">(</span><span>thunk</span><span class="token" style="color:#f8f8f2">,</span><span> logger</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">(</span><span>createStore</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">(</span><span>reducer</span><span class="token" style="color:#f8f8f2">,</span><span> preloadedState</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">;</span><span>
</span>
<span></span><span class="token" style="color:#6272a4">// applyMiddleware chainéƒ¨åˆ†</span><span>
</span><span></span><span class="token" style="color:#8be9fd">const</span><span> middlewareAPI </span><span class="token" style="color:#f8f8f2">=</span><span> </span><span class="token" style="color:#f8f8f2">{</span><span> getState</span><span class="token" style="color:#f8f8f2">,</span><span> dispatch </span><span class="token" style="color:#f8f8f2">}</span><span>
</span>
<span></span><span class="token" style="color:#8be9fd">const</span><span> chain </span><span class="token" style="color:#f8f8f2">=</span><span> </span><span class="token" style="color:#f8f8f2">[</span><span>thunk</span><span class="token" style="color:#f8f8f2">,</span><span> logger</span><span class="token" style="color:#f8f8f2">]</span><span class="token" style="color:#f8f8f2">.</span><span class="token method property-access" style="color:#f1fa8c">map</span><span class="token" style="color:#f8f8f2">(</span><span class="token parameter">middleware</span><span> </span><span class="token arrow" style="color:#f8f8f2">=&gt;</span><span> </span><span class="token" style="color:#f1fa8c">middleware</span><span class="token" style="color:#f8f8f2">(</span><span>middlewareAPI</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">)</span><span>
</span><span></span><span class="token" style="color:#6272a4">// const chain = [thunk(middlewareAPI), logger(middlewareAPI)]</span><span>
</span><span></span><span class="token" style="color:#6272a4">// const chain = [thunk({ getState, dispatch }), logger({ getState, dispatch })]</span><span>
</span>
<span></span><span class="token" style="color:#6272a4">// applyMiddleware compose dispatchéƒ¨åˆ†</span><span>
</span><span>dispatch </span><span class="token" style="color:#f8f8f2">=</span><span> </span><span class="token" style="color:#f1fa8c">compose</span><span class="token" style="color:#f8f8f2">(</span><span class="token spread" style="color:#f8f8f2">...</span><span>chain</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">(</span><span>store</span><span class="token" style="color:#f8f8f2">.</span><span class="token property-access">dispatch</span><span class="token" style="color:#f8f8f2">)</span><span>
</span><span></span><span class="token" style="color:#6272a4">// dispatch = compose(thunk({ getState, dispatch }), logger({ getState, dispatch }))(store.dispatch)</span><span>
</span>
<span></span><span class="token" style="color:#6272a4">// æ ¹æ® compose ä»£ç å¯è½¬åŒ–ä¸º</span><span>
</span><span></span><span class="token" style="color:#6272a4">// dispatch = thunk({ getState, dispatch })(logger({ getState, dispatch })(store.dispatch))</span></code></pre><p>ä»£ç åˆ°è¿™è¾¹æˆ‘ä»¬éœ€è¦ç»“åˆ <strong>redux-thunk</strong> æºç ç»§ç»­è§£æäº†</p><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-js" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#8be9fd">function</span><span> </span><span class="token" style="color:#f1fa8c">createThunkMiddleware</span><span class="token" style="color:#f8f8f2">(</span><span class="token parameter">extraArgument</span><span class="token" style="color:#f8f8f2">)</span><span> </span><span class="token" style="color:#f8f8f2">{</span><span>
</span><span>  </span><span class="token control-flow" style="color:#8be9fd">return</span><span> </span><span class="token" style="color:#f8f8f2">(</span><span class="token parameter" style="color:#f8f8f2">{</span><span class="token parameter"> dispatch</span><span class="token parameter" style="color:#f8f8f2">,</span><span class="token parameter"> getState </span><span class="token parameter" style="color:#f8f8f2">}</span><span class="token" style="color:#f8f8f2">)</span><span> </span><span class="token arrow" style="color:#f8f8f2">=&gt;</span><span> </span><span class="token" style="color:#f8f8f2">(</span><span class="token parameter">next</span><span class="token" style="color:#f8f8f2">)</span><span> </span><span class="token arrow" style="color:#f8f8f2">=&gt;</span><span> </span><span class="token" style="color:#f8f8f2">(</span><span class="token parameter">action</span><span class="token" style="color:#f8f8f2">)</span><span> </span><span class="token arrow" style="color:#f8f8f2">=&gt;</span><span> </span><span class="token" style="color:#f8f8f2">{</span><span>
</span><span>    </span><span class="token control-flow" style="color:#8be9fd">if</span><span> </span><span class="token" style="color:#f8f8f2">(</span><span class="token" style="color:#8be9fd">typeof</span><span> action </span><span class="token" style="color:#f8f8f2">===</span><span> </span><span class="token" style="color:#50fa7b">&#x27;function&#x27;</span><span class="token" style="color:#f8f8f2">)</span><span> </span><span class="token" style="color:#f8f8f2">{</span><span>
</span><span>      </span><span class="token control-flow" style="color:#8be9fd">return</span><span> </span><span class="token" style="color:#f1fa8c">action</span><span class="token" style="color:#f8f8f2">(</span><span>dispatch</span><span class="token" style="color:#f8f8f2">,</span><span> getState</span><span class="token" style="color:#f8f8f2">,</span><span> extraArgument</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">;</span><span>
</span><span>    </span><span class="token" style="color:#f8f8f2">}</span><span>
</span>
<span>    </span><span class="token control-flow" style="color:#8be9fd">return</span><span> </span><span class="token" style="color:#f1fa8c">next</span><span class="token" style="color:#f8f8f2">(</span><span>action</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">;</span><span>
</span><span>  </span><span class="token" style="color:#f8f8f2">}</span><span class="token" style="color:#f8f8f2">;</span><span>
</span><span></span><span class="token" style="color:#f8f8f2">}</span><span>
</span>
<span></span><span class="token" style="color:#8be9fd">const</span><span> thunk </span><span class="token" style="color:#f8f8f2">=</span><span> </span><span class="token" style="color:#f1fa8c">createThunkMiddleware</span><span class="token" style="color:#f8f8f2">(</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">;</span><span>
</span><span>thunk</span><span class="token" style="color:#f8f8f2">.</span><span class="token property-access">withExtraArgument</span><span> </span><span class="token" style="color:#f8f8f2">=</span><span> createThunkMiddleware</span><span class="token" style="color:#f8f8f2">;</span><span>
</span>
<span></span><span class="token module" style="color:#8be9fd">export</span><span> </span><span class="token module" style="color:#8be9fd">default</span><span> thunk</span><span class="token" style="color:#f8f8f2">;</span></code></pre><p>æŠŠ</p><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-js" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>dispatch </span><span class="token" style="color:#f8f8f2">=</span><span> </span><span class="token" style="color:#f1fa8c">thunk</span><span class="token" style="color:#f8f8f2">(</span><span class="token" style="color:#f8f8f2">{</span><span> getState</span><span class="token" style="color:#f8f8f2">,</span><span> dispatch </span><span class="token" style="color:#f8f8f2">}</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">(</span><span class="token" style="color:#f1fa8c">logger</span><span class="token" style="color:#f8f8f2">(</span><span class="token" style="color:#f8f8f2">{</span><span> getState</span><span class="token" style="color:#f8f8f2">,</span><span> dispatch </span><span class="token" style="color:#f8f8f2">}</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">(</span><span>store</span><span class="token" style="color:#f8f8f2">.</span><span class="token property-access">dispatch</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">)</span></code></pre><p>æ”¾åˆ° <strong>thunk</strong> ä¸­</p><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-js" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token function-variable" style="color:#f1fa8c">dispatch</span><span> </span><span class="token" style="color:#f8f8f2">=</span><span> </span><span class="token" style="color:#f8f8f2">(</span><span class="token parameter" style="color:#f8f8f2">{</span><span class="token parameter"> getState</span><span class="token parameter" style="color:#f8f8f2">,</span><span class="token parameter"> dispatch </span><span class="token parameter" style="color:#f8f8f2">}</span><span class="token" style="color:#f8f8f2">)</span><span> </span><span class="token arrow" style="color:#f8f8f2">=&gt;</span><span> </span><span class="token" style="color:#f8f8f2">{</span><span>
</span><span>  </span><span class="token control-flow" style="color:#8be9fd">return</span><span> </span><span class="token" style="color:#f8f8f2">(</span><span class="token parameter" style="color:#f8f8f2">{</span><span class="token parameter"> getState</span><span class="token parameter" style="color:#f8f8f2">,</span><span class="token parameter"> dispatch </span><span class="token parameter" style="color:#f8f8f2">}</span><span class="token" style="color:#f8f8f2">)</span><span> </span><span class="token arrow" style="color:#f8f8f2">=&gt;</span><span> </span><span class="token" style="color:#f8f8f2">(</span><span class="token parameter" style="color:#f1fa8c">logger</span><span class="token parameter" style="color:#f8f8f2">(</span><span class="token parameter" style="color:#f8f8f2">{</span><span class="token parameter"> getState</span><span class="token parameter" style="color:#f8f8f2">,</span><span class="token parameter"> dispatch </span><span class="token parameter" style="color:#f8f8f2">}</span><span class="token parameter" style="color:#f8f8f2">)</span><span class="token parameter" style="color:#f8f8f2">(</span><span class="token parameter">store</span><span class="token parameter" style="color:#f8f8f2">.</span><span class="token parameter property-access">dispatch</span><span class="token parameter" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">)</span><span> </span><span class="token arrow" style="color:#f8f8f2">=&gt;</span><span> </span><span class="token" style="color:#f8f8f2">(</span><span class="token parameter">action</span><span class="token" style="color:#f8f8f2">)</span><span> </span><span class="token arrow" style="color:#f8f8f2">=&gt;</span><span> </span><span class="token" style="color:#f8f8f2">{</span><span>
</span>
<span>    </span><span class="token" style="color:#6272a4">// å¦‚æœæœ‰å¼‚æ­¥actionï¼Œä¼šå…ˆæ‰§è¡Œå¼‚æ­¥actionï¼Œåœ¨æ‰§è¡Œä¼ è¿›æ¥çš„logger function</span><span>
</span><span>    </span><span class="token control-flow" style="color:#8be9fd">if</span><span> </span><span class="token" style="color:#f8f8f2">(</span><span class="token" style="color:#8be9fd">typeof</span><span> action </span><span class="token" style="color:#f8f8f2">===</span><span> </span><span class="token" style="color:#50fa7b">&#x27;function&#x27;</span><span class="token" style="color:#f8f8f2">)</span><span> </span><span class="token" style="color:#f8f8f2">{</span><span>
</span><span>      </span><span class="token control-flow" style="color:#8be9fd">return</span><span> </span><span class="token" style="color:#f1fa8c">action</span><span class="token" style="color:#f8f8f2">(</span><span>dispatch</span><span class="token" style="color:#f8f8f2">,</span><span> getState</span><span class="token" style="color:#f8f8f2">,</span><span> extraArgument</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">;</span><span>
</span><span>    </span><span class="token" style="color:#f8f8f2">}</span><span>
</span>
<span>    </span><span class="token control-flow" style="color:#8be9fd">return</span><span> </span><span class="token" style="color:#f1fa8c">logger</span><span class="token" style="color:#f8f8f2">(</span><span class="token" style="color:#f8f8f2">{</span><span> getState</span><span class="token" style="color:#f8f8f2">,</span><span> dispatch </span><span class="token" style="color:#f8f8f2">}</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">(</span><span>store</span><span class="token" style="color:#f8f8f2">.</span><span class="token property-access">dispatch</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">(</span><span>action</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">;</span><span>
</span><span>  </span><span class="token" style="color:#f8f8f2">}</span><span>
</span><span></span><span class="token" style="color:#f8f8f2">}</span></code></pre><p>åº”ç”¨äº† <strong>thunk</strong> å’Œ <strong>logger</strong> çš„ <strong>redux</strong> åº”ç”¨ï¼Œä¼šå…ˆæ‰§è¡Œå¼‚æ­¥ <strong>action</strong>ï¼Œåœ¨æ‰§è¡Œ <strong>logger</strong> ä¸­é—´ä»¶ã€‚</p><p>ä»ä»£ç ä¸Šçœ‹ï¼Œ<strong>applyMiddleware</strong> æœ€ä¸»è¦çš„ä½œç”¨å°±æ˜¯å¯¹åŸå§‹çš„ <strong>dispatch</strong> æ–¹æ³•è¿›è¡Œäº†é‡æ–°èµ‹å€¼ï¼Œå¹¶å°†å®ƒä¸ <strong>store</strong> çš„å±æ€§è¿”å›ã€‚</p><h2>å‚è€ƒ</h2><ul><li><a href="https://github.com/reduxjs/redux-thunk/blob/master/src/index.js">redux-thunk</a></li></ul></div><hr class="mt-4"/><footer><div class="flex items-center mt-8 mb-16"><picture class="flex-shrink-0 mb-0 mr-3 rounded-full w-14 h-14 select-none cursor-pointer hvr-float-shadow"><source type="image/webp" data-srcset="/_next/static/images/profile-8ed88833980dc158e6d9ec3b1bb7c0a8.png.webp"/><source type="image/png" data-srcset="/_next/static/images/profile-44443f720aaa2ff4c2b67336ff9f586b.png"/><img class="lazyload blur flex-shrink-0 mb-0 mr-3 rounded-full w-14 h-14 select-none cursor-pointer hvr-float-shadow" alt="Profile" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAJCAYAAAALpr0TAAAAAklEQVR4AewaftIAAAFBSURBVAXBSS8DYQCA4fcz33RqWpUuU8tEkKjtUqIhJELiRCJxcfRf/AknP8OFiwMXF40DSVO0iRhLVbR0mX08jzg63Ikc28NzA1QR8vBcJ6Eq9AYUDMNAxlOsrBSRH40WIoLJbIL1qTzS63JvfRKJECd0MM0h9IREmZ4YOyaAw7UCG6UlNpfneaw8UbNa4Ie4tk9uSEO6nouCoO9FZEZNWu8WcUViZpLsH+wyMjnBX7eDzCuQ0zVsAtpvb1RrL9Stb3RNkO//MSwl6mAcWRrNMLO1jZ5UuSiXITXO6vISp+eXbNs+olal02kj/YUidiyJ5wsK63u8N74xSxmmyrecnF2TNtJoUkUa2RxO95ew3+al1yXm9tCCiLnCLPqrRbP5QSRC5GLsi0DVkekUj5UKjZ8+TSdA6ikWigYDqs/VzR3/TEV/Airrby8AAAAASUVORK5CYII="/></picture><p class="text-base leading-7">Written by <b class="font-semibold">xudd</b> <!-- -->who wants to become richï¼ï¼ï¼<!-- --> <a href="https://twitter.com/https://twitter.com/WhyYouJames">Follow him on twitter</a></p></div></footer></article><nav class="flex flex-wrap justify-between mb-10"><a class="text-lg font-bold" href="/post/currying">â† <!-- -->æŸ¯é‡ŒåŒ–-Currying</a><a class="text-lg font-bold" href="/post/method">jså¸¸ç”¨æ–¹æ³•é›†åˆï¼ˆä¸€ï¼‰<!-- --> â†’</a></nav></main><footer class="text-lg font-light mt-3">Â© <!-- -->2021<!-- --> <!-- -->Built with<!-- --> <a href="https://nextjs.org/">Next.js</a>ğŸ”¥, Deployed on<!-- --> <a href="https://pages.github.com/">GitHub Pages</a></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontmatter":{"title":"reduxæºç ç³»åˆ—ä¹‹applyMiddleware","date":"June 28, 2021","description":null},"post":{"content":"\nç»ˆäºæ¥åˆ° **applyMiddleware** éƒ¨åˆ†ï¼Œç†è§£äº† [**compose**](https://xudongdong.site/post/compose) å’Œ [**Currying**](https://xudongdong.site/post/currying)ï¼Œè¿™éƒ¨åˆ†æºç ä¹Ÿå˜å¾—å¾ˆå¥½ç†è§£\n\nè¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥åº”ç”¨ä¸­é—´ä»¶çš„ï¼Œç”¨è¿‡ **node** çš„åŒå­¦åº”è¯¥æ¯”è¾ƒäº†è§£ï¼Œä¸­é—´ä»¶æˆ‘çš„ç†è§£ç±»ä¼¼äºæ’ä»¶ï¼Œä¸€èˆ¬ä¸ºäº†é¿å…ç³»ç»Ÿæ¡†æ¶è¿‡äºè‡ƒè‚¿ï¼Œæˆ‘ä»¬æŠŠå¸¸ç”¨çš„åŠŸèƒ½å‰¥ç¦»å¼€æ¥ï¼Œä»¥ä¸­é—´ä»¶çš„å½¢å¼æ’å…¥åˆ°æ¡†æ¶ä¸­æ¥å®ç°å¤æ‚çš„åº”ç”¨å¤„ç†\n\næˆ‘ä»¬é¦–å…ˆçœ‹ä¸‹ **applyMiddleware** çš„ç”¨æ³•\n\n``` js\nimport { applyMiddleware } from 'redux';\nimport thunk from 'redux-thunk';\nimport logger from 'redux-logger';\n\nconst store = createStore(reducer, applyMiddleware(thunk, logger))\n```\n\n**createStore** å†…éƒ¨çš„è°ƒç”¨\n\n``` js\nfunction createStore(reducer, preloadedState, enhancer) {\n  // ä¼ å…¥å‚æ•°çš„åˆ¤æ–­\n  // ...\n\n  // å‚æ•°ä¸­enhancer functionå­˜åœ¨ï¼Œä¸€èˆ¬æ˜¯æŒ‡applyMiddleware()\n  if (typeof enhancer !== \"undefined\" \u0026\u0026 typeof enhancer === \"function\") {\n    return enhancer(createStore)(reducer, preloadedState);\n  }\n\n  // çœç•¥\n}\n```\n\nç”±æ­¤å¯ä»¥å¾—å‡º **applyMiddleware** çš„ **API** è°ƒç”¨\n\n``` js\napplyMiddleware(thunk, logger)(createStore)(reducer, preloadedState);\n\n// applyMiddleware(...middlewares)(createStore)(reducer, preloadedState);\n```\n\nç»“åˆæºç \n\næˆ‘ä»¬å°†æºç ä¸­ **TS** éƒ¨åˆ†å»é™¤ï¼Œå¾—å‡ºå‡½æ•°ä¸»ä½“ä»£ç \n\n``` javascript\nimport { compose } from \"./compose\";\n\nfunction applyMiddleware(...middlewares) {\n  // use Currying function\n  return (createStore) =\u003e (reducer, preloadedState) =\u003e {\n    // è·å–store\n    const store = createStore(reducer, preloadedState);\n    // åˆå§‹åŒ–dispatch\n    let dispatch = () =\u003e {\n      // åœ¨dispatchå®Œæˆæ­£åœ¨èµ‹å€¼ä¹‹å‰ï¼Œè°ƒç”¨ä¼šæŠ¥é”™\n      throw new Error(\"ç›®å‰è¿˜ä¸èƒ½ä½¿ç”¨dispatch\")\n    }\n\n    // ç»™æ¯ä¸ªä¸­é—´ä»¶çš„é»˜è®¤ä¼ å‚ï¼šgetStateï¼Œdispatch\n    const middlewareAPI = {\n      getState: store.getState,\n      dispatch: (action, ...args) =\u003e dispatch(action, ...args)\n    }\n    \n    // åŠ å…¥é»˜è®¤å‚æ•°åçš„ä¸­é—´ä»¶chain\n    const chain = middlewares.map(middleware =\u003e middleware(middlewareAPI))\n    // å¯¹chainåšcomposeæ“ä½œï¼Œå¹¶èµ‹å€¼ç»™dispatch\n    dispatch = compose(...chain)(store.dispatch)\n  }\n\n  // è¿”å›storeçš„å±æ€§å’Œdispatch\n  return {\n    ...store,\n    dispatch\n  }\n}\n```\n\nä¸»è¦éš¾ä»¥ç†è§£çš„éƒ¨åˆ†è¿˜æ˜¯ **compose** è¿™ä¸€å—\n\næˆ‘ä»¬æ‹¿ä¸¤ä¸ªä¸­é—´ä»¶åšè§£æ\n\n``` javascript\nimport thunk from 'redux-thunk';\nimport logger from 'redux-logger';\n\napplyMiddleware(thunk, logger)(createStore)(reducer, preloadedState);\n\n// applyMiddleware chainéƒ¨åˆ†\nconst middlewareAPI = { getState, dispatch }\n\nconst chain = [thunk, logger].map(middleware =\u003e middleware(middlewareAPI))\n// const chain = [thunk(middlewareAPI), logger(middlewareAPI)]\n// const chain = [thunk({ getState, dispatch }), logger({ getState, dispatch })]\n\n// applyMiddleware compose dispatchéƒ¨åˆ†\ndispatch = compose(...chain)(store.dispatch)\n// dispatch = compose(thunk({ getState, dispatch }), logger({ getState, dispatch }))(store.dispatch)\n\n// æ ¹æ® compose ä»£ç å¯è½¬åŒ–ä¸º\n// dispatch = thunk({ getState, dispatch })(logger({ getState, dispatch })(store.dispatch))\n```\n\nä»£ç åˆ°è¿™è¾¹æˆ‘ä»¬éœ€è¦ç»“åˆ **redux-thunk** æºç ç»§ç»­è§£æäº†\n\n``` js\nfunction createThunkMiddleware(extraArgument) {\n  return ({ dispatch, getState }) =\u003e (next) =\u003e (action) =\u003e {\n    if (typeof action === 'function') {\n      return action(dispatch, getState, extraArgument);\n    }\n\n    return next(action);\n  };\n}\n\nconst thunk = createThunkMiddleware();\nthunk.withExtraArgument = createThunkMiddleware;\n\nexport default thunk;\n```\n\næŠŠ\n``` js\ndispatch = thunk({ getState, dispatch })(logger({ getState, dispatch })(store.dispatch))\n```\n\næ”¾åˆ° **thunk** ä¸­\n\n``` js\ndispatch = ({ getState, dispatch }) =\u003e {\n  return ({ getState, dispatch }) =\u003e (logger({ getState, dispatch })(store.dispatch)) =\u003e (action) =\u003e {\n\n    // å¦‚æœæœ‰å¼‚æ­¥actionï¼Œä¼šå…ˆæ‰§è¡Œå¼‚æ­¥actionï¼Œåœ¨æ‰§è¡Œä¼ è¿›æ¥çš„logger function\n    if (typeof action === 'function') {\n      return action(dispatch, getState, extraArgument);\n    }\n\n    return logger({ getState, dispatch })(store.dispatch)(action);\n  }\n}\n```\n\nåº”ç”¨äº† **thunk** å’Œ **logger** çš„ **redux** åº”ç”¨ï¼Œä¼šå…ˆæ‰§è¡Œå¼‚æ­¥ **action**ï¼Œåœ¨æ‰§è¡Œ **logger** ä¸­é—´ä»¶ã€‚\n\nä»ä»£ç ä¸Šçœ‹ï¼Œ**applyMiddleware** æœ€ä¸»è¦çš„ä½œç”¨å°±æ˜¯å¯¹åŸå§‹çš„ **dispatch** æ–¹æ³•è¿›è¡Œäº†é‡æ–°èµ‹å€¼ï¼Œå¹¶å°†å®ƒä¸ **store** çš„å±æ€§è¿”å›ã€‚\n\n\n## å‚è€ƒ\n- [redux-thunk](https://github.com/reduxjs/redux-thunk/blob/master/src/index.js)\n\n","excerpt":""},"previousPost":{"slug":"currying","frontmatter":{"title":"æŸ¯é‡ŒåŒ–-Currying","date":"June 23, 2021","description":null},"excerpt":"","content":"\nä¹‹å‰çœ‹ **Redux compose** éƒ¨åˆ†æºä»£ç çš„æ—¶å€™ï¼Œå°±æ„Ÿè§‰å’Œ **æŸ¯é‡ŒåŒ–ï¼ˆCurryingï¼‰** å¾ˆåƒï¼Œæ‰€ä»¥è¿™ç¯‡æŠŠå®ƒå®‰æ’ä¸Šäº†ï¼ŒåŒå±äºå‡½æ•°å¼ç¼–ç¨‹èŒƒç•´ã€‚\n\n## What\n\nä»€ä¹ˆæ˜¯æŸ¯é‡ŒåŒ–ï¼ˆCurryingï¼‰\n\n**æŸ¯é‡ŒåŒ–** å¤§å®¶åº”è¯¥å¬è¯´è¿‡ï¼Œæˆ–è®¸è¿˜æœ‰äº›äº†è§£ï¼Œä½†æ˜¯åˆ°åº•ä»€ä¹ˆæ ·çš„èŒƒå¼æ‰æ˜¯æŸ¯é‡ŒåŒ–å‘¢ï¼Ÿ\n\n\u003eåœ¨ç»´åŸºç™¾ç§‘ä¸Šçš„å®šä¹‰æ˜¯è¿™æ ·ï¼š***currying is the technique of converting a function that takes multiple arguments into a sequence of functions that each takes a single argument***.\n\né¦–å…ˆæ˜¯ä¸€ä¸ªæŠ€æœ¯ï¼Œä½œç”¨æ˜¯å°†ä¸€ä¸ªæ‹¥æœ‰å¤šä¸ªå‚æ•°çš„å‡½æ•°è½¬åŒ–æˆä¸€ç³»åˆ—åªèƒ½ä¼ å…¥ä¸€ä¸ªå‚æ•°çš„å‡½æ•°ã€‚\n\nè¿˜æ˜¯æ¯”è¾ƒæŠ½è±¡ï¼Œé€šè¿‡ä»£ç \n\n``` js\nconst add = (x) =\u003e (y) =\u003e x + y;\n```\n\nè¿™ç§å¤š **=\u003e** çš„ä»£ç ç»å¸¸è§ï¼Œå…¶å®å°±æ˜¯ **ES6** ç‰ˆçš„æŸ¯é‡ŒåŒ–ï¼Œæˆ‘ä»¬å¯ä»¥è½¬åŒ–ä¸‹\n\nè§‰å¾—ç†è§£å›°éš¾çš„å¯ä»¥å€Ÿç”¨ **[Babel](https://www.babeljs.cn/repl)** æ¥è½¬åŒ–\n\n``` js\nvar add = function add(x) {\n  return function (y) {\n    return x + y;\n  };\n};\n```\n\nä¸ç”¨ **æŸ¯é‡ŒåŒ–ï¼ˆCurryingï¼‰**:\n\n``` js\nconst add = (a, b, c) =\u003e {\n  return a + b + c;\n}\n```\n\nåœ¨æ•°å­¦å’Œè®¡ç®—æœºç§‘å­¦ä¸­çš„æŸ¯é‡ŒåŒ–å‡½æ•°ï¼Œä¸€æ¬¡åªèƒ½ä¼ é€’ä¸€ä¸ªå‚æ•°ï¼›\n\nè€Œæˆ‘ä»¬ **Javascript** å®é™…åº”ç”¨ä¸­çš„æŸ¯é‡ŒåŒ–å‡½æ•°ï¼Œå¯ä»¥ä¼ é€’ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°ã€‚\n\n``` js\n//æ™®é€šå‡½æ•°\nfunction fn(a, b, c, d, e) {\n  return a + b + c + d + e;\n}\n//ç”Ÿæˆçš„æŸ¯é‡ŒåŒ–å‡½æ•°\nconst curryFn = curry(fn);\n\ncurryFn(1,2,3,4,5);     // 15\ncurryFn(1)(2)(3,4,5);   // 15\ncurryFn(1,2)(3,4)(5);   // 15\ncurryFn(1)(2)(3)(4)(5); // 15\n\n```\n\né‚£ä¹ˆä»€ä¹ˆæ—¶å€™åº”è¯¥ç”¨ **æŸ¯é‡ŒåŒ–ï¼ˆCurryingï¼‰** å‘¢ï¼Œæ€»ä¸è‡³äºæˆ‘ä»¬å°±æ˜¯ç”¨æ¥ä¸ºäº†ç»™ä¸‰ä¸ªæ•°å­—æ±‚å’Œã€‚\n\n## When\n\nä¸¾ä¸ªä¾‹å­ğŸŒ°\n\nç§‘é¢œæ°æœ‰ä¸€æ¬¾çˆ†ç«çš„çˆ½è‚¤æ°´ï¼Œç»å¸¸ä¼šæœ‰æ´»åŠ¨ä¿ƒé”€æ‰“æŠ˜ï¼Œæ‰“æŠ˜åŠ›åº¦å¾€å¾€ä¸ä¸€æ ·\n\næ‰€ä»¥ä»–ä»¬ä¼šè¿™æ ·è®¡ç®—æŠ˜åä»·æ ¼\n\n``` js\nconst discountPrice = (price, dicount) =\u003e {\n  return price * dicount;\n}\n\ndiscountPrice(300, 0.9);\ndiscountPrice(300, 0.95);\ndiscountPrice(300, 0.85);\ndiscountPrice(300, 0.88);\n```\n\nå…¶å®æˆ‘ä»¬ä¼šå‘ç°ï¼Œè™½ç„¶æŠ˜æ‰£ç»å¸¸å˜ï¼Œä½†æ˜¯å®ƒæœ¬èº«çš„ä»·æ ¼åŸºæœ¬ä¸å˜\n\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨ **æŸ¯é‡ŒåŒ–ï¼ˆCurryingï¼‰** ä¼˜åŒ–ä¸‹ä»£ç ç»“æ„\n\n``` js\nconst defaultPrice = 300; // çˆ½è‚¤æ°´é»˜è®¤ä»·æ ¼\n\nconst discountPrice = (price) =\u003e {\n  return (dicount) =\u003e {\n    return price * dicount;\n  }\n}\n\n// const discountPrice = price =\u003e dicount =\u003e price * dicount\n\nconst tonerdDscountPrice = discountPrice(defaultPrice);\n\ntonerdDscountPrice(0.9);\ntonerdDscountPrice(0.95);\ntonerdDscountPrice(0.85);\ntonerdDscountPrice(0.88);\n```\n\nä¸‹é¢çš„ä»£ç æ˜¯ä¸æ˜¯è°ƒç”¨çš„æ—¶å€™æ›´åŠ èˆ’çˆ½ä¸€ç‚¹\n\n## Why\n\né‚£ä¹ˆ **æŸ¯é‡ŒåŒ–ï¼ˆCurryingï¼‰** æœ‰å•¥å¥½å¤„å‘¢\n\næŸ¯é‡ŒåŒ–æœ¬è´¨ä¸Šæ˜¯ ***é™ä½é€šç”¨æ€§ï¼Œæé«˜é€‚ç”¨æ€§***ã€‚\n\næ€ä¹ˆç†è§£...\n\nç»“åˆæ‰“æŠ˜çš„ä¾‹å­çœ‹ï¼Œ\n\né™ä½é€šç”¨æ€§æ˜¯æŒ‡ **Currying** ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥çµæ´»çš„ä¼ å…¥é»˜è®¤ä»·æ ¼ï¼Œæˆ‘å¯ä»¥ç®—å‡ºçˆ½è‚¤æ°´æŠ˜æ‰£ä»·æ ¼ï¼Œä¹Ÿå¯ä»¥ç®—å‡ºé¢è†œæŠ˜æ‰£ä»·æ ¼ï¼Œå¾ˆé€šç”¨\n\nä½†æ˜¯ **Currying** ä¹‹åæ›´åŠ é€‚ç”¨äºç®—å‡ºçˆ½è‚¤æ°´æŠ˜æ‰£ä»·æ ¼äº†ï¼Œéƒ½ä¸ç”¨ä¼ å…¥é»˜è®¤ä»·æ ¼äº†ï¼Œæå–äº†ä¸€ä¸ªé€šç”¨çš„æ–¹æ³•å¯¹é»˜è®¤ä»·æ ¼è¿›è¡Œå¤„ç†ï¼Œåªè¦ä¼ å…¥æŠ˜æ‰£ä»·æ ¼\n\næ‰€ä»¥ï¼Œå…³äºä½¿ç”¨å…¶å®æ˜¯ä¸ªå–èˆé—®é¢˜ï¼Œéœ€ç»“åˆå…·ä½“åœºæ™¯\n\n\n\n\n\n\n\n## å‚è€ƒ\n- [currying-javascript](https://www.dottedsquirrel.com/currying-javascript/)\n- [wiki-Currying](https://en.wikipedia.org/wiki/Currying)\n- [javascript-currying-what-is-the-point-of-currying-javascript-functions](https://www.jondjones.com/frontend/javascript/functional-programming/javascript-currying-what-is-the-point-of-currying-javascript-functions/)\n- [ã€Œå‰ç«¯è¿›é˜¶ã€å½»åº•å¼„æ‡‚å‡½æ•°æŸ¯é‡ŒåŒ–](https://juejin.cn/post/6844903882208837645)"},"nextPost":{"slug":"method","frontmatter":{"title":"jså¸¸ç”¨æ–¹æ³•é›†åˆï¼ˆä¸€ï¼‰","date":"June 30, 2021","description":null},"excerpt":"","content":"\n## Array\n\n1. å°†è¾“å…¥å€¼è½¬åŒ–ä¸ºæ•°ç»„\n\n``` javascript\nconst castArray = value =\u003e Array.isArray(value) ? value : [value];\n\n// Examples\ncastArray(1);               // [1]\ncastArray([1, 2, 3]);       // [1, 2, 3]\n```\n\n2. åˆ¤æ–­æ•°ç»„æ˜¯å¦ä¸ºç©º\n\n``` javascript\nconst isEmpty = arr =\u003e Array.isArray(arr) \u0026\u0026 arr.length === 0;\n\n// Examples\nisEmpty(1);             // false\nisEmpty([]);            // true\nisEmpty([1, 2, 3]);     // false\n```\n\n3. æ‹·è´ä¸€ä¸ªæ•°ç»„\n\n``` javascript\n// `arr` is an array\nconst clone = arr =\u003e arr.slice(0);\n\n// Or\nconst clone = arr =\u003e arr.concat([]);\n\n// Or\nconst clone = arr =\u003e [...arr];\n\n// Or\nconst clone = arr =\u003e Array.from(arr);\n\n// Or\nconst clone = arr =\u003e arr.map(v =\u003e v);\n```\n\n4. å¯¹æ¯”ä¸¤ä¸ªæ•°ç»„æ˜¯å¦ä¸€æ ·\n   \n``` javascript\nconst isEqual = (arr1, arr2) =\u003e arr1.length === arr2.length \u0026\u0026 arr1.every((v, i) =\u003e v === arr2[i]);\n\n// Examples\nisEqual([1, 2, 3], [1, 2, 3]);      // true\nisEqual([1, 2, 3], [1, '2', 3]);    // false\n```\n\n5. æ ¹æ®æŸä¸ªå±æ€§å°†æ•°ç»„è½¬åŒ–ä¸ºå¯¹è±¡ï¼ˆå±æ€§ä½œä¸ºkeyï¼‰\n\n``` javascript\nconst toObject = (arr, key) =\u003e arr.reduce((a, b) =\u003e ({...a, [b[key]]: b}), {});\n\n// Example\ntoObject(\n    [\n        { id: '1', name: 'Alpha', gender: 'Male' },\n        { id: '2', name: 'Bravo', gender: 'Male' },\n        { id: '3', name: 'Charlie', gender: 'Female' },\n    ],\n    'id'\n);\n/* \n{\n    '1': { id: '1', name: 'Alpha', gender: 'Male' },\n    '2': { id: '2', name: 'Bravo', gender: 'Male' },\n    '3': { id: '3', name: 'Charlie', gender: 'Female' },\n}\n*/\n```\n\n6. æ‰¾å‡ºæ•°ç»„ä¸­æœ€å¤§çš„å€¼ï¼ˆNumberï¼‰\n\n``` javascript\nconst indexOfMax = arr =\u003e arr.reduce((prev, v, i, a) =\u003e v \u003e a[prev] ? i : prev, 0);\n\n// Examples\nindexOfMax([1, 3, 9, 7, 5]);        // 2\nindexOfMax([1, 3, 7, 7, 5]);        // 2\n```\n\n7. æ ¹æ®å±æ€§æ‰¾å‡ºæ•°ç»„ä¸­å±æ€§å€¼æœ€å¤§çš„\n\n``` javascript\nconst maxBy = (arr, key) =\u003e arr.reduce((a, b) =\u003e a[key] \u003e= b[key] ? a : b, {});\n\n// Example\nconst people = [\n    { name: 'Bar', age: 24 },\n    { name: 'Baz', age: 32 },\n    { name: 'Foo', age: 42 },\n    { name: 'Fuzz', age: 36 },\n];\nmaxBy(people, 'age');   // { name: 'Foo', age: 42 }\n```\n\n8. æ•°ç»„å»é‡\n\n``` javascript\nconst unique = arr =\u003e Array.from(new Set(arr));\n\n// Or\nconst unique = arr =\u003e arr.filter((el, i, array) =\u003e array.indexOf(el) === i);\n```\n\n9. ä»¥å±æ€§å€¼ä¸ºkeyå°†æ•°ç»„è½¬åŒ–æˆå¯¹è±¡\n\n``` javascript\nconst groupBy = (arr, key) =\u003e arr.reduce((acc, item) =\u003e ((acc[item[key]] = [...(acc[item[key]] || []), item]), acc), {});\n\n// Example\ngroupBy([\n    { branch: 'audi', model: 'q8', year: '2019' },\n    { branch: 'audi', model: 'rs7', year: '2020' },\n    { branch: 'ford', model: 'mustang', year: '2019' },\n    { branch: 'ford', model: 'explorer', year: '2020' },\n    { branch: 'bmw', model: 'x7', year: '2020' },\n], 'branch');\n\n/*\n{\n    audi: [\n        { branch: 'audi', model: 'q8', year: '2019' },\n        { branch: 'audi', model: 'rs7', year: '2020' }\n    ],\n    bmw: [\n        { branch: 'bmw', model: 'x7', year: '2020' }\n    ],\n    ford: [\n        { branch: 'ford', model: 'mustang', year: '2019' },\n        { branch: 'ford', model: 'explorer', year: '2020' }\n    ],\n}\n*/\n```\n\n10. æ ¹æ®å±æ€§å€¼ç»™æ•°ç»„æ’åº\n\n``` javascript\nconst sortBy = (arr, k) =\u003e arr.concat().sort((a, b) =\u003e (a[k] \u003e b[k]) ? 1 : ((a[k] \u003c b[k]) ? -1 : 0));\n\n// Example\nconst people = [\n    { name: 'Foo', age: 42 },\n    { name: 'Bar', age: 24 },\n    { name: 'Fuzz', age: 36 },\n    { name: 'Baz', age: 32 },\n];\nsortBy(people, 'age');\n\n// returns\n//  [\n//      { name: 'Bar', age: 24 },\n//      { name: 'Baz', age: 32 },\n//      { name: 'Fuzz', age: 36 },\n//      { name: 'Foo', age: 42 },\n//  ]\n```\n\n## DOM\n\n1. åˆ¤æ–­æ˜¯å¦ä¸ºæŸä¸ªå…ƒç´ çš„å­èŠ‚ç‚¹\n\n``` javascript\nconst isDescendant = (child, parent) =\u003e parent.contains(child);\n```\n\n2. åˆ¤æ–­å½“å‰å…ƒç´ æ˜¯å¦æ˜¯FocusçŠ¶æ€\n\n``` javascript\nconst isFocus = ele =\u003e ele === document.activeElement;\n```\n\n3. åˆ¤æ–­é¡µé¢æ˜¯å¦æ»‘åˆ°åº•éƒ¨\n\n``` javascript\nconst isAtBottom = () =\u003e document.documentElement.clientHeight + window.scrollY \u003e= document.documentElement.scrollHeight;\n```\n\n4. å½“å‰æµè§ˆå™¨åˆ¤æ–­\n\n``` javascript\n\n// IE\nconst isIE = !!document.documentMode;\n\n// Chrome\nconst isChrome = !!window.chrome \u0026\u0026 (!!window.chrome.webstore || !!window.chrome.runtime);\n\n// macOS browser\nconst isMacBrowser = /Mac|iPod|iPhone|iPad/.test(navigator.platform);\n```\n\n5. è·å–ç”¨æˆ·é€‰ä¸­çš„æ–‡æœ¬\n\n``` javascript\nconst getSelectedText = () =\u003e window.getSelection().toString();\n```\n\n6. éšè—å…ƒç´ \n  \n``` javascript\nconst hide = ele =\u003e ele.style.display = 'none';\n\n// Or\nconst hide = ele =\u003e ele.style.visibility = 'hidden';\n\n// Or\nconst hide = ele =\u003e ele.hidden = true;\n```\n\n7. å°†å…ƒç´ æ’å…¥æŸä¸ªå…ƒç´ ä¹‹å\n\n``` javascript\nconst insertAfter = (ele, anotherEle) =\u003e anotherEle.parentNode.insertBefore(ele, anotherEle.nextSibling);\n\n// Or\nconst insertAfter = (ele, anotherEle) =\u003e anotherEle.insertAdjacentElement('afterend', ele);\n```\n\n8. è·³è½¬é¡µé¢\n\n``` javascript\nconst goTo = url =\u003e location.href = url;\n```\n\n9. é‡æ–°åŠ è½½å½“å‰é¡µ\n\n``` javascript\nconst reload = () =\u003e location.reload();\n\n// Or\nconst reload = () =\u003e (location.href = location.href);\n```\n\n10. æ›¿æ¢å…ƒç´ \n\n``` javascript\nconst replace = (ele, newEle) =\u003e ele.parentNode.replaceChild(newEle, ele);\n```\n\n11. å›åˆ°é¡µé¢é¡¶éƒ¨\n\n``` javascript\nconst goToTop = () =\u003e window.scrollTo(0, 0);\n```"}},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"applyMiddleware"},"buildId":"x1UupnU7GzVpoQshz8q7s","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-8f31809deb7932dd0187.js"></script><script src="/_next/static/chunks/main-c6f966696d7d46f48c33.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.10b3d8f36ae5d485c3da.js" async=""></script><script src="/_next/static/chunks/commons.18cd929bdef6e2f96561.js" async=""></script><script src="/_next/static/chunks/pages/_app-7c6d80ab417193f95407.js" async=""></script><script src="/_next/static/chunks/1173eff4538ab0eae4f3f506dea9a7965770ad37.102498c830e6881bc94f.js" async=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-0058a7b1fd50a50b0cad.js" async=""></script><script src="/_next/static/x1UupnU7GzVpoQshz8q7s/_buildManifest.js" async=""></script><script src="/_next/static/x1UupnU7GzVpoQshz8q7s/_ssgManifest.js" async=""></script></body></html>