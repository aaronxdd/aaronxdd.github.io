{"pageProps":{"frontmatter":{"title":"æŸ¯é‡ŒåŒ–-Currying","date":"June 23, 2021","description":null},"post":{"content":"\nä¹‹å‰çœ‹ **Redux compose** éƒ¨åˆ†æºä»£ç çš„æ—¶å€™ï¼Œå°±æ„Ÿè§‰å’Œ **æŸ¯é‡ŒåŒ–ï¼ˆCurryingï¼‰** å¾ˆåƒï¼Œæ‰€ä»¥è¿™ç¯‡æŠŠå®ƒå®‰æ’ä¸Šäº†ï¼ŒåŒå±äºå‡½æ•°å¼ç¼–ç¨‹èŒƒç•´ã€‚\n\n## What\n\nä»€ä¹ˆæ˜¯æŸ¯é‡ŒåŒ–ï¼ˆCurryingï¼‰\n\n**æŸ¯é‡ŒåŒ–** å¤§å®¶åº”è¯¥å¬è¯´è¿‡ï¼Œæˆ–è®¸è¿˜æœ‰äº›äº†è§£ï¼Œä½†æ˜¯åˆ°åº•ä»€ä¹ˆæ ·çš„èŒƒå¼æ‰æ˜¯æŸ¯é‡ŒåŒ–å‘¢ï¼Ÿ\n\n>åœ¨ç»´åŸºç™¾ç§‘ä¸Šçš„å®šä¹‰æ˜¯è¿™æ ·ï¼š***currying is the technique of converting a function that takes multiple arguments into a sequence of functions that each takes a single argument***.\n\né¦–å…ˆæ˜¯ä¸€ä¸ªæŠ€æœ¯ï¼Œä½œç”¨æ˜¯å°†ä¸€ä¸ªæ‹¥æœ‰å¤šä¸ªå‚æ•°çš„å‡½æ•°è½¬åŒ–æˆä¸€ç³»åˆ—åªèƒ½ä¼ å…¥ä¸€ä¸ªå‚æ•°çš„å‡½æ•°ã€‚\n\nè¿˜æ˜¯æ¯”è¾ƒæŠ½è±¡ï¼Œé€šè¿‡ä»£ç \n\n``` js\nconst add = (x) => (y) => x + y;\n```\n\nè¿™ç§å¤š **=>** çš„ä»£ç ç»å¸¸è§ï¼Œå…¶å®å°±æ˜¯ **ES6** ç‰ˆçš„æŸ¯é‡ŒåŒ–ï¼Œæˆ‘ä»¬å¯ä»¥è½¬åŒ–ä¸‹\n\nè§‰å¾—ç†è§£å›°éš¾çš„å¯ä»¥å€Ÿç”¨ **[Babel](https://www.babeljs.cn/repl)** æ¥è½¬åŒ–\n\n``` js\nvar add = function add(x) {\n  return function (y) {\n    return x + y;\n  };\n};\n```\n\nä¸ç”¨ **æŸ¯é‡ŒåŒ–ï¼ˆCurryingï¼‰**:\n\n``` js\nconst add = (a, b, c) => {\n  return a + b + c;\n}\n```\n\nåœ¨æ•°å­¦å’Œè®¡ç®—æœºç§‘å­¦ä¸­çš„æŸ¯é‡ŒåŒ–å‡½æ•°ï¼Œä¸€æ¬¡åªèƒ½ä¼ é€’ä¸€ä¸ªå‚æ•°ï¼›\n\nè€Œæˆ‘ä»¬ **Javascript** å®é™…åº”ç”¨ä¸­çš„æŸ¯é‡ŒåŒ–å‡½æ•°ï¼Œå¯ä»¥ä¼ é€’ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°ã€‚\n\n``` js\n//æ™®é€šå‡½æ•°\nfunction fn(a, b, c, d, e) {\n  return a + b + c + d + e;\n}\n//ç”Ÿæˆçš„æŸ¯é‡ŒåŒ–å‡½æ•°\nconst curryFn = curry(fn);\n\ncurryFn(1,2,3,4,5);     // 15\ncurryFn(1)(2)(3,4,5);   // 15\ncurryFn(1,2)(3,4)(5);   // 15\ncurryFn(1)(2)(3)(4)(5); // 15\n\n```\n\né‚£ä¹ˆä»€ä¹ˆæ—¶å€™åº”è¯¥ç”¨ **æŸ¯é‡ŒåŒ–ï¼ˆCurryingï¼‰** å‘¢ï¼Œæ€»ä¸è‡³äºæˆ‘ä»¬å°±æ˜¯ç”¨æ¥ä¸ºäº†ç»™ä¸‰ä¸ªæ•°å­—æ±‚å’Œã€‚\n\n## When\n\nä¸¾ä¸ªä¾‹å­ğŸŒ°\n\nç§‘é¢œæ°æœ‰ä¸€æ¬¾çˆ†ç«çš„çˆ½è‚¤æ°´ï¼Œç»å¸¸ä¼šæœ‰æ´»åŠ¨ä¿ƒé”€æ‰“æŠ˜ï¼Œæ‰“æŠ˜åŠ›åº¦å¾€å¾€ä¸ä¸€æ ·\n\næ‰€ä»¥ä»–ä»¬ä¼šè¿™æ ·è®¡ç®—æŠ˜åä»·æ ¼\n\n``` js\nconst discountPrice = (price, dicount) => {\n  return price * dicount;\n}\n\ndiscountPrice(300, 0.9);\ndiscountPrice(300, 0.95);\ndiscountPrice(300, 0.85);\ndiscountPrice(300, 0.88);\n```\n\nå…¶å®æˆ‘ä»¬ä¼šå‘ç°ï¼Œè™½ç„¶æŠ˜æ‰£ç»å¸¸å˜ï¼Œä½†æ˜¯å®ƒæœ¬èº«çš„ä»·æ ¼åŸºæœ¬ä¸å˜\n\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨ **æŸ¯é‡ŒåŒ–ï¼ˆCurryingï¼‰** ä¼˜åŒ–ä¸‹ä»£ç ç»“æ„\n\n``` js\nconst defaultPrice = 300; // çˆ½è‚¤æ°´é»˜è®¤ä»·æ ¼\n\nconst discountPrice = (price) => {\n  return (dicount) => {\n    return price * dicount;\n  }\n}\n\n// const discountPrice = price => dicount => price * dicount\n\nconst tonerdDscountPrice = discountPrice(defaultPrice);\n\ntonerdDscountPrice(0.9);\ntonerdDscountPrice(0.95);\ntonerdDscountPrice(0.85);\ntonerdDscountPrice(0.88);\n```\n\nä¸‹é¢çš„ä»£ç æ˜¯ä¸æ˜¯è°ƒç”¨çš„æ—¶å€™æ›´åŠ èˆ’çˆ½ä¸€ç‚¹\n\n## Why\n\né‚£ä¹ˆ **æŸ¯é‡ŒåŒ–ï¼ˆCurryingï¼‰** æœ‰å•¥å¥½å¤„å‘¢\n\næŸ¯é‡ŒåŒ–æœ¬è´¨ä¸Šæ˜¯ ***é™ä½é€šç”¨æ€§ï¼Œæé«˜é€‚ç”¨æ€§***ã€‚\n\næ€ä¹ˆç†è§£...\n\nç»“åˆæ‰“æŠ˜çš„ä¾‹å­çœ‹ï¼Œ\n\né™ä½é€šç”¨æ€§æ˜¯æŒ‡ **Currying** ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥çµæ´»çš„ä¼ å…¥é»˜è®¤ä»·æ ¼ï¼Œæˆ‘å¯ä»¥ç®—å‡ºçˆ½è‚¤æ°´æŠ˜æ‰£ä»·æ ¼ï¼Œä¹Ÿå¯ä»¥ç®—å‡ºé¢è†œæŠ˜æ‰£ä»·æ ¼ï¼Œå¾ˆé€šç”¨\n\nä½†æ˜¯ **Currying** ä¹‹åæ›´åŠ é€‚ç”¨äºç®—å‡ºçˆ½è‚¤æ°´æŠ˜æ‰£ä»·æ ¼äº†ï¼Œéƒ½ä¸ç”¨ä¼ å…¥é»˜è®¤ä»·æ ¼äº†ï¼Œæå–äº†ä¸€ä¸ªé€šç”¨çš„æ–¹æ³•å¯¹é»˜è®¤ä»·æ ¼è¿›è¡Œå¤„ç†ï¼Œåªè¦ä¼ å…¥æŠ˜æ‰£ä»·æ ¼\n\næ‰€ä»¥ï¼Œå…³äºä½¿ç”¨å…¶å®æ˜¯ä¸ªå–èˆé—®é¢˜ï¼Œéœ€ç»“åˆå…·ä½“åœºæ™¯\n\n\n\n\n\n\n\n## å‚è€ƒ\n- [currying-javascript](https://www.dottedsquirrel.com/currying-javascript/)\n- [wiki-Currying](https://en.wikipedia.org/wiki/Currying)\n- [javascript-currying-what-is-the-point-of-currying-javascript-functions](https://www.jondjones.com/frontend/javascript/functional-programming/javascript-currying-what-is-the-point-of-currying-javascript-functions/)\n- [ã€Œå‰ç«¯è¿›é˜¶ã€å½»åº•å¼„æ‡‚å‡½æ•°æŸ¯é‡ŒåŒ–](https://juejin.cn/post/6844903882208837645)","excerpt":""},"previousPost":{"slug":"compose","frontmatter":{"title":"reduxæºç ç³»åˆ—ä¹‹compose","date":"June 23, 2021","description":null},"excerpt":"","content":"\næœ¬æ¥æƒ³å†™ **applyMiddleware** æ–¹æ³•ä»£ç è§£æçš„ï¼Œç„¶åä¸€çœ‹ï¼Œé‡Œé¢æœ‰ä¸ª **compose** æ–¹æ³•ï¼Œå¥½åƒå†…éƒ¨ä»£ç ä¹Ÿè°ƒç”¨çš„æ¯”è¾ƒå¤šï¼Œæƒ³äº†æƒ³å°±å†³å®šå…ˆçœ‹ä¸‹ **compose** ç›¸å…³ä»£ç ã€‚\n\n``` javascript\nimport { compose } from 'redux'\n\nconst composeFn = compose(fn1, fn2, fn3, fn4)\nconst b = composeFn(x)\n// ç­‰ä»·äº\nconst b = fn1(fn2(fn3(fn4(x))))\n```\nä»ä½¿ç”¨ä¸Šå¤§æ¦‚å¯ä»¥çœ‹å‡ºå®ƒçš„ä½œç”¨ï¼Œä»å³å¾€å·¦çš„ç»„åˆæ‰§è¡Œå¤šä¸ªå‡½æ•°ï¼Œå°†å¤šä¸ªå‡½æ•°ç»„åˆæˆä¸€ä¸ªå‡½æ•°ï¼Œå³è¾¹å‡½æ•°çš„æ‰§è¡Œç»“æœæ˜¯å·¦è¾¹å‡½æ•°çš„å‚æ•°å€¼ï¼Œ\né™¤äº†æœ€å³è¾¹çš„å‡½æ•°å¯ä»¥ä¼ å…¥å¤šä¸ªå‚æ•°ï¼Œå…¶ä½™å‡½æ•°åªèƒ½ä¼ å…¥ä¸€ä¸ªå‚æ•°ã€‚\n\n## å‚æ•°\n1. **(arguments)**: éœ€è¦ç»„åˆçš„å‡½æ•°ã€‚\n\n## è¿”å›å€¼\n**(Function)**: ä»å³åˆ°å·¦æŠŠæ¥æ”¶åˆ°çš„å‡½æ•°åˆæˆåçš„æœ€ç»ˆå‡½æ•°ã€‚\n\n## ä»£ç ç»“æ„\nä»£ç ç®—æ˜¯å¾ˆç®€å•äº†ï¼Œæˆ‘ä»¬åˆ†ä¸¤éƒ¨åˆ†å»ç†è§£\n\n### ä¸ŠåŠéƒ¨åˆ†\n\n``` typescript\nexport default function compose(): <R>(a: R) => R\n\nexport default function compose<F extends Function>(f: F): F\n\n/* two functions */\nexport default function compose<A, T extends any[], R>(\n  f1: (a: A) => R,\n  f2: Func<T, A>\n): Func<T, R>\n\n/* three functions */\nexport default function compose<A, B, T extends any[], R>(\n  f1: (b: B) => R,\n  f2: (a: A) => B,\n  f3: Func<T, A>\n): Func<T, R>\n\n/* four functions */\nexport default function compose<A, B, C, T extends any[], R>(\n  f1: (c: C) => R,\n  f2: (b: B) => C,\n  f3: (a: A) => B,\n  f4: Func<T, A>\n): Func<T, R>\n\n/* rest */\nexport default function compose<R>(\n  f1: (a: any) => R,\n  ...funcs: Function[]\n): (...args: any[]) => R\n\nexport default function compose<R>(...funcs: Function[]): (...args: any[]) => R\n\nexport default function compose(...funcs: Function[]) {\n  \n}\n```\n\nå£°æ˜å„ç§ä¸åŒå‚æ•°çš„ **compose**ï¼Œå…¶å®æ˜¯é‡è½½ï¼Œä¸ºäº†å†™ä»£ç æ—¶æœ‰æ›´å¥½çš„ä»£ç æç¤ºã€‚\n\n### æ ¸å¿ƒéƒ¨åˆ†\n``` typescript\nreturn funcs.reduce(\n  (a, b) =>\n    (...args: any) =>\n      a(b(...args))\n)\n```\næœ€å **compose return** çš„æ˜¯å‡½æ•°æ•°ç»„ï¼ˆå³ä¼ å…¥çš„å‚æ•°ï¼‰çš„ **reduce** æ–¹æ³•ï¼Œæ˜¾è€Œæ˜“è§çš„èƒ½ç»„åˆæˆé«˜é˜¶å‡½æ•°çš„å½¢å¼ã€‚\n\n## æ€»ç»“\n\n``` javascript\ncompose(fn1, fn2, fn3, fn4)(...args) === fn1(fn2(fn3(fn4(...args))))\n```\n\n**compose** å‡½æ•°åœ¨å‡½æ•°å¼ç¼–ç¨‹é‡Œå¾ˆå¸¸è§ã€‚è¿™é‡Œ **redux** çš„å¯¹ **compose** å®ç°å¾ˆç®€å•ï¼Œä¸»è¦è¿˜æ˜¯è¦å¯¹ **Array.prototype.reduce** å‡½æ•°è¦ç†Ÿç»ƒã€‚\n\n"},"nextPost":{"slug":"applyMiddleware","frontmatter":{"title":"reduxæºç ç³»åˆ—ä¹‹applyMiddleware","date":"June 28, 2021","description":null},"excerpt":"","content":"\nç»ˆäºæ¥åˆ° **applyMiddleware** éƒ¨åˆ†ï¼Œç†è§£äº† [**compose**](https://xudongdong.site/post/compose) å’Œ [**Currying**](https://xudongdong.site/post/currying)ï¼Œè¿™éƒ¨åˆ†æºç ä¹Ÿå˜å¾—å¾ˆå¥½ç†è§£\n\nè¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥åº”ç”¨ä¸­é—´ä»¶çš„ï¼Œç”¨è¿‡ **node** çš„åŒå­¦åº”è¯¥æ¯”è¾ƒäº†è§£ï¼Œä¸­é—´ä»¶æˆ‘çš„ç†è§£ç±»ä¼¼äºæ’ä»¶ï¼Œä¸€èˆ¬ä¸ºäº†é¿å…ç³»ç»Ÿæ¡†æ¶è¿‡äºè‡ƒè‚¿ï¼Œæˆ‘ä»¬æŠŠå¸¸ç”¨çš„åŠŸèƒ½å‰¥ç¦»å¼€æ¥ï¼Œä»¥ä¸­é—´ä»¶çš„å½¢å¼æ’å…¥åˆ°æ¡†æ¶ä¸­æ¥å®ç°å¤æ‚çš„åº”ç”¨å¤„ç†\n\næˆ‘ä»¬é¦–å…ˆçœ‹ä¸‹ **applyMiddleware** çš„ç”¨æ³•\n\n``` js\nimport { applyMiddleware } from 'redux';\nimport thunk from 'redux-thunk';\nimport logger from 'redux-logger';\n\nconst store = createStore(reducer, applyMiddleware(thunk, logger))\n```\n\n**createStore** å†…éƒ¨çš„è°ƒç”¨\n\n``` js\nfunction createStore(reducer, preloadedState, enhancer) {\n  // ä¼ å…¥å‚æ•°çš„åˆ¤æ–­\n  // ...\n\n  // å‚æ•°ä¸­enhancer functionå­˜åœ¨ï¼Œä¸€èˆ¬æ˜¯æŒ‡applyMiddleware()\n  if (typeof enhancer !== \"undefined\" && typeof enhancer === \"function\") {\n    return enhancer(createStore)(reducer, preloadedState);\n  }\n\n  // çœç•¥\n}\n```\n\nç”±æ­¤å¯ä»¥å¾—å‡º **applyMiddleware** çš„ **API** è°ƒç”¨\n\n``` js\napplyMiddleware(thunk, logger)(createStore)(reducer, preloadedState);\n\n// applyMiddleware(...middlewares)(createStore)(reducer, preloadedState);\n```\n\nç»“åˆæºç \n\næˆ‘ä»¬å°†æºç ä¸­ **TS** éƒ¨åˆ†å»é™¤ï¼Œå¾—å‡ºå‡½æ•°ä¸»ä½“ä»£ç \n\n``` javascript\nimport { compose } from \"./compose\";\n\nfunction applyMiddleware(...middlewares) {\n  // use Currying function\n  return (createStore) => (reducer, preloadedState) => {\n    // è·å–store\n    const store = createStore(reducer, preloadedState);\n    // åˆå§‹åŒ–dispatch\n    let dispatch = () => {\n      // åœ¨dispatchå®Œæˆæ­£åœ¨èµ‹å€¼ä¹‹å‰ï¼Œè°ƒç”¨ä¼šæŠ¥é”™\n      throw new Error(\"ç›®å‰è¿˜ä¸èƒ½ä½¿ç”¨dispatch\")\n    }\n\n    // ç»™æ¯ä¸ªä¸­é—´ä»¶çš„é»˜è®¤ä¼ å‚ï¼šgetStateï¼Œdispatch\n    const middlewareAPI = {\n      getState: store.getState,\n      dispatch: (action, ...args) => dispatch(action, ...args)\n    }\n    \n    // åŠ å…¥é»˜è®¤å‚æ•°åçš„ä¸­é—´ä»¶chain\n    const chain = middlewares.map(middleware => middleware(middlewareAPI))\n    // å¯¹chainåšcomposeæ“ä½œï¼Œå¹¶èµ‹å€¼ç»™dispatch\n    dispatch = compose(...chain)(store.dispatch)\n  }\n\n  // è¿”å›storeçš„å±æ€§å’Œdispatch\n  return {\n    ...store,\n    dispatch\n  }\n}\n```\n\nä¸»è¦éš¾ä»¥ç†è§£çš„éƒ¨åˆ†è¿˜æ˜¯ **compose** è¿™ä¸€å—\n\næˆ‘ä»¬æ‹¿ä¸¤ä¸ªä¸­é—´ä»¶åšè§£æ\n\n``` javascript\nimport thunk from 'redux-thunk';\nimport logger from 'redux-logger';\n\napplyMiddleware(thunk, logger)(createStore)(reducer, preloadedState);\n\n// applyMiddleware chainéƒ¨åˆ†\nconst middlewareAPI = { getState, dispatch }\n\nconst chain = [thunk, logger].map(middleware => middleware(middlewareAPI))\n// const chain = [thunk(middlewareAPI), logger(middlewareAPI)]\n// const chain = [thunk({ getState, dispatch }), logger({ getState, dispatch })]\n\n// applyMiddleware compose dispatchéƒ¨åˆ†\ndispatch = compose(...chain)(store.dispatch)\n// dispatch = compose(thunk({ getState, dispatch }), logger({ getState, dispatch }))(store.dispatch)\n\n// æ ¹æ® compose ä»£ç å¯è½¬åŒ–ä¸º\n// dispatch = thunk({ getState, dispatch })(logger({ getState, dispatch })(store.dispatch))\n```\n\nä»£ç åˆ°è¿™è¾¹æˆ‘ä»¬éœ€è¦ç»“åˆ **redux-thunk** æºç ç»§ç»­è§£æäº†\n\n``` js\nfunction createThunkMiddleware(extraArgument) {\n  return ({ dispatch, getState }) => (next) => (action) => {\n    if (typeof action === 'function') {\n      return action(dispatch, getState, extraArgument);\n    }\n\n    return next(action);\n  };\n}\n\nconst thunk = createThunkMiddleware();\nthunk.withExtraArgument = createThunkMiddleware;\n\nexport default thunk;\n```\n\næŠŠ\n``` js\ndispatch = thunk({ getState, dispatch })(logger({ getState, dispatch })(store.dispatch))\n```\n\næ”¾åˆ° **thunk** ä¸­\n\n``` js\ndispatch = ({ getState, dispatch }) => {\n  return ({ getState, dispatch }) => (logger({ getState, dispatch })(store.dispatch)) => (action) => {\n\n    // å¦‚æœæœ‰å¼‚æ­¥actionï¼Œä¼šå…ˆæ‰§è¡Œå¼‚æ­¥actionï¼Œåœ¨æ‰§è¡Œä¼ è¿›æ¥çš„logger function\n    if (typeof action === 'function') {\n      return action(dispatch, getState, extraArgument);\n    }\n\n    return logger({ getState, dispatch })(store.dispatch)(action);\n  }\n}\n```\n\nåº”ç”¨äº† **thunk** å’Œ **logger** çš„ **redux** åº”ç”¨ï¼Œä¼šå…ˆæ‰§è¡Œå¼‚æ­¥ **action**ï¼Œåœ¨æ‰§è¡Œ **logger** ä¸­é—´ä»¶ã€‚\n\nä»ä»£ç ä¸Šçœ‹ï¼Œ**applyMiddleware** æœ€ä¸»è¦çš„ä½œç”¨å°±æ˜¯å¯¹åŸå§‹çš„ **dispatch** æ–¹æ³•è¿›è¡Œäº†é‡æ–°èµ‹å€¼ï¼Œå¹¶å°†å®ƒä¸ **store** çš„å±æ€§è¿”å›ã€‚\n\n\n## å‚è€ƒ\n- [redux-thunk](https://github.com/reduxjs/redux-thunk/blob/master/src/index.js)\n\n"}},"__N_SSG":true}